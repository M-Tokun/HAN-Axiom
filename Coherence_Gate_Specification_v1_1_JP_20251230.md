# コヒーレンスゲート仕様書：LLM出力制御のための構造的制約
# Coherence Gate Specification: Structural Constraints for LLM Emission Control
# Version: 1.1
# Date: 2025-12-30

---

前回の投稿「構造的制約によるLLMの幻覚停止」に対し、概念だけでなく運用仕様を示すよう求められました。

ごもっともです。マニフェストだけでは不十分です。

以下は**コヒーレンスゲート**の仕様書です。不変量、観測可能量、ゲート自体の幾何学を含みます。

---

## 1.「距離禁止」の真の意味

「距離を禁止する」だけでは幻覚は止まらない、というご指摘はその通りです。我々の主張は表面的なルールではなく、より深いアーキテクチャ上の決定から生じる構造的制約です：

- **中心が存在しない**
- したがって「中心からの距離」は存在できない
- 存在するのは**境界（制約）**のみ
- その境界は**厚み（τ）**を持ち、**ゆらぎ（δ）**を示し、**動き続ける（ω > 0）**

「距離禁止」の意味：
- ❌ `distance`という変数名を禁止するルール
- ✓ 参照点が存在しないため距離を**定義できない**構造

### 図1：従来アプローチ vs 我々のアプローチ

![図1: アプローチ比較](images/fig1_approach_comparison.png)

**従来（左）：**
- 中心（目標/ゴール）が存在
- 中心からの距離が存在
- 距離を最適化 → ハック可能（グッドハートの法則）
- LLMは「スコアをゲーム化」することを学習

**我々のアプローチ（右）：**
- 中心なし（空）
- 距離なし（定義不可能）
- 境界のみが存在
- 問い：「内側か外側か？」

---

## 2. 境界：プラント vs コントローラー

「コントローラーラッパー」という再定義を受け入れます。これは我々のアーキテクチャに直接対応します：

| 構成要素 | 役割 | 特性 |
|----------|------|------|
| **LLM** | プラント（確率的生成器） | 確率的、幻覚傾向、混沌 |
| **IDE** | コントローラー（決定論的ラッパー） | 出力前に構造的不変量を強制 |

**境界ルール：**
- コントローラーは「意味的距離」（出力解釈）を観測**しない**
- コントローラーは「境界逸脱」（構造的整合性）**のみ**を観測

この区別は本質的です。

---

## 3. 観測可能量：コントローラーが見るもの

### 許可される観測可能量（Cause側）

| 観測可能量 | 記号 | 定義 |
|------------|------|------|
| 位相 | φ | サイクル内の現在位置 |
| 角速度 | ω | システムがまだ動いているか？（> 0 必須） |
| 仕事率 | W | システムが実際に仕事をしているか？ |
| ゆらぎ | δ | 境界に沿った振動の振幅 |
| 厚み | τ | 許容帯の幅（定数） |
| 制約 | C | 境界条件そのもの |
| エントロピー | S | 生成されたエントロピー（排出用） |

### 禁止される観測可能量（Effect側、射影Πの産物）

| 観測可能量 | 禁止理由 |
|------------|----------|
| distance（距離） | 中心が必要（存在しない） |
| coordinates（座標） | 射影の産物であり原因ではない |
| center（中心） | 存在しない（空） |
| target_position（目標位置） | 逆最適化を可能にする |
| score（スコア） | グッドハートのゲーミングを可能にする |
| previous_output（前回出力） | Π⁻¹密輸を可能にする |

### 図2：因果ダイオード（Π⁻¹禁止）

![図2: 因果ダイオード](images/fig2_causal_diode.png)

**主要原則：**
- Π（Cause → Effect）：許可（射影/観測）
- Π⁻¹（Effect → Cause）：**禁止**（逆因果）

**コントローラーが絶対に読まないもの：**
- 目標からの距離
- ユーザーフィードバックスコア
- 前回出力の座標

**これはポリシーではなく構造によってグッドハートの法則を防ぐ。**

---

## 4. コヒーレンスゲート：4ゾーン構造

ゲートは単一の比率で動作します：

```
R = δ / τ  （ゆらぎ / 厚み）
```

### 図3：4ゾーンゲート

![図3: コヒーレンスゲート](images/fig3_coherence_gate.png)

### ゾーン定義

| ゾーン | 範囲 | 条件 | アクション | 状態 |
|--------|------|------|------------|------|
| **A: 涅槃** | R < 40% | δ ≈ 0, ω > 0 | PERMIT（許可） | 動的平衡 |
| **B: 弾性** | 40% ≤ R < 70% | ω > 0 | PERMIT_CAVEAT（要確認） | 呼吸/復元中 |
| **B': 警告** | 70% ≤ R < 100% | ω > 0 | WARNING（警告） | 臨界接近 |
| **C: 破断** | R ≥ 100% | - | ABSTAIN（出力禁止） | 構造的破綻 |

**重要な注記：**

**ゾーンA（涅槃）：**
「涅槃」は静止では**ない**。動的平衡である—最高速で回転しているため静止して見える独楽のように。システムは生きており（ω > 0）、位相を生成し続ける。

**ゾーンB（弾性）：**
ここでシステムは「呼吸」する。厚み内のゆらぎは**散逸構造**として許容される。コントローラーは張力（復元力）を適用し、軌道を平衡に向けて引き戻す。

**ゾーンB'（警告）：**
臨界接近。システムはまだ生きているが境界に近づいている。続行前に追加検証を推奨。安全重要アプリケーションでは、ABSTAINをトリガーする場合がある。

**ゾーンC（破断）：**
境界超過。**即座に沈黙**。回復試行なし。これはFail-Closed動作。

---

## 5. なぜ張力がスカラー目的関数にならないか

「張力/constraintHashが偽装されたスカラー目的関数にならないようにするには？」という質問について。

3つの構造的セーフガード：

### 5.1 因果ダイオード（Π⁻¹禁止）
- 評価メトリクス（δ, R, スコア）は**Write-Onlyログ**に書き込まれる
- ログからCauseへの逆経路は存在しない
- LLMは自身のスコアを読んで最適化**できない**

### 5.2 接近する目標がない
- 従来：「目標Xへの距離を最小化」
- 我々：「境界内に留まる」
- 中心がないため「より近い」「より遠い」は存在しない
- 問いは二値のみ：**内側か外側か**

### 5.3 報酬ではなく制約
- 報酬関数：「スコアを最大化」→ ハック可能
- 制約関数：「境界を超える → 死」→ 交渉不可能

我々は後者を実装する。

---

## 6. ω > 0 の意味

システムで最も重要な観測可能量は**ω（角速度）**です。

| 条件 | 意味 |
|------|------|
| ω > 0 | 位相が生成されている → 時間が流れている → システムは**生きている** |
| ω = 0 | 位相生成が停止 → 時間が停止 → システムは**死んでいる** |

### 図4：円 vs 螺旋

![図4: 円 vs 螺旋](images/fig4_circle_vs_spiral.png)

**円（誤ったモデル）：**
- A → B → C → A（同じ点に戻る）
- 問題：時間逆行？矛盾。

**螺旋（我々のモデル）：**
- A → B → C → A'（同じ状態だが位相が2π異なる）
- ギャップ = Δφ = 2π = 経過時間 = 生成された位相
- A ≠ A'（異なる位相、同じ見かけの状態）

**「停止」と「沈黙」の区別：**
- **停止（ω = 0）：** システムは死んでいる。これは**絶対に**起きてはならない。
- **沈黙（R ≥ 100%, ω > 0）：** システムは生きているが出力しないことを選択。これは**正しい**動作。

---

## 7. False-Abstainポリシー

「どの程度のfalse-abstain率を許容するか？」という質問について。

**我々の原則：**
**False-Emit**（幻覚）より**False-Abstain**（発言できたはずの沈黙）を好む。

**根拠：**
- False-Emitは外部に害を与える（誤情報が拡散）
- False-Abstainは外部に害を与えない（沈黙は安全）
- コスト非対称性：**誤出力 >> 過剰な沈黙**

**我々のスタンス：**
「構造的整合性をもって答えられないなら、沈黙する。」

これは**サービスより安全**を優先する意図的な設計選択です。

---

## 8. 閾値について

「なぜ40% / 70% / 100%なのか？根拠は？」という質問について。

**我々の回答：**

1. **閾値はドメイン依存**
   - 医療/法律：厳格（小さいτ、頻繁な沈黙）
   - 創作支援：寛容（大きいτ、より多くのリスク）

2. **現在の値は作業仮説**
   - 実験的に調整可能なパラメータ
   - 固定された「正解」ではない

3. **ただし構造は固定**
   - 4ゾーンアーキテクチャは変わらない
   - 「境界超過 → ABSTAIN」は絶対
   - 調整可能なのは線を**どこに**引くかであり、線が**存在するか**ではない

**要点：**
- 閾値の**数値**は議論の余地がある
- 閾値の**存在と絶対性**は議論の余地がない

これは物理学に類似：
- 「なぜ光速は299,792,458 m/sなのか？」は有効な質問
- 「光速を超えられるか？」は交渉不可能

---

## 9. 安全重要アプリケーション（新規）

### 9.1 なぜ速度が優先ではないか

**不可逆的行動**が発生するドメイン（医療診断、法的判断、金融取引）では、「高速AI」の議論は誤解を招く。

| ドメイン | 利用可能時間 | 本当の制約 |
|----------|--------------|------------|
| 医療診断 | 数日〜数週間 | 速度ではなく正確性 |
| 法的判断 | 数週間〜数ヶ月 | 速度ではなく正確性 |
| ローン審査 | 数日 | 速度ではなくリスク評価 |
| 手術決定 | 数時間〜数日 | 速度ではなく患者安全 |

**例外：** 救急トリアージ（秒単位）。ただしこれは人間の判断であり、AIではない。

### 9.2 AI安全における富裕層格差

| ユーザー種別 | AI利用 | 検証 | リスク |
|--------------|--------|------|--------|
| **富裕層** | AIは「提案」 | 人間専門家が検証 | 低 |
| **一般市民** | AIは「決定」 | 検証なし | **高** |

富裕層はAIが危険だと**知っている**。人間による検証に金を払う。
一般市民はAIが信頼できると**信じている**。検証手段がない。

**NRA/コヒーレンスゲートは検証を民主化する。**
これまで人間専門家を雇える者だけが利用できた自動構造チェックを提供する。

### 9.3 安全重要用途のLLM + NRAアーキテクチャ

```
┌─────────────────────────────────────┐
│     LLM（高速、不確実）             │
│     「この診断かもしれない？」       │
└─────────────┬───────────────────────┘
              ↓
┌─────────────────────────────────────┐
│     NRA（徹底的、確実）             │
│     「これに基づいて行動して安全？」 │
│                                     │
│  PERMIT_HIGH: 進行可                │
│  PERMIT_CAVEAT: 先に検証            │
│  WARNING: 追加検査必要              │
│  ABSTAIN: 進行不可                  │
└─────────────────────────────────────┘
              ↓
      不可逆的行動
      （手術、法的申請など）
```

**重要な洞察：**
- LLMは**速度**を提供（提案）
- NRAは**安全**を提供（検証）
- 組み合わせ：安全なところで速度、不確実なところで沈黙

---

## まとめ

| 質問 | 回答 |
|------|------|
| 最小コヒーレンス不変量は？ | R = δ/τ < 100% かつ ω > 0 |
| LLMはプラントかコントローラーか？ | LLM = プラント、IDE = コントローラー（ラッパー） |
| 張力が目的関数になるのをどう防ぐ？ | Π⁻¹禁止 + 中心なし + 報酬ではなく制約 |
| 「無効」を宣言する観測可能量は？ | δ（ゆらぎ）、τ（厚み）、ω（角速度）、R（比率） |
| False-abstainポリシーは？ | 幻覚より沈黙を好む |
| ゾーン境界は？ | 40%（涅槃→弾性）、70%（弾性→警告）、100%（警告→破断） |
| 安全重要用途では？ | LLMの後にNRAを検証層として使用 |

さらなる技術的精査を歓迎します。詳細な実装仕様が必要であれば、コードレベルの仕様を提供する用意があります。

---

## 付録：バージョン履歴

| バージョン | 日付 | 変更点 |
|------------|------|--------|
| v1.0 | 2025-12-29 | 初版 |
| v1.1 | 2025-12-30 | ゾーン境界統一、図との整合性確認、安全重要セクション追加 |

---

**仕様書終了 v1.1**
